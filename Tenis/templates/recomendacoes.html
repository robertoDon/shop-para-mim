{% extends "base.html" %}

{% block title %}Recomendações - Shop Pra Mim{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <div class="text-center">
            <i class="fas fa-magic fa-3x text-primary mb-3"></i>
            <h1 class="h3 mb-0">Recomendações Geradas!</h1>
            <p class="text-muted">Clientes ideais para o produto cadastrado</p>
        </div>
    </div>
</div>

<div class="row mb-4">
    <div class="col-12">
        <div class="card bg-light">
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h5 class="mb-1">Produto Cadastrado</h5>
                        <p class="mb-0">
                            <strong>{{ produto.marca }} {{ produto.modelo }}</strong> - 
                            {{ produto.cor }}, Tamanho {{ produto.tamanho }} - 
                            <span class="text-success">R$ {{ "%.2f"|format(produto.preco) }}</span>
                        </p>
                    </div>
                    <div class="col-md-4 text-end">
                        <a href="{{ url_for('listar_produtos') }}" class="btn btn-primary">
                            <i class="fas fa-box me-2"></i>Ver Estoque
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-users me-2"></i>Clientes Recomendados
                    <span class="badge bg-primary ms-2">{{ recomendacoes|length }}</span>
                </h5>
            </div>
            <div class="card-body">
                {% if recomendacoes %}
                <div class="row">
                    {% for cliente, score in recomendacoes %}
                    <div class="col-lg-6 mb-3">
                        <div class="card h-100 border-{{ loop.index0 == 0 and 'success' or (loop.index0 == 1 and 'warning' or 'secondary') }}">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <h6 class="card-title mb-0">
                                        {% if loop.index0 == 0 %}
                                            <i class="fas fa-crown text-warning me-1"></i>
                                        {% endif %}
                                        {{ cliente.nome }}
                                    </h6>
                                    <span class="badge bg-{{ loop.index0 == 0 and 'success' or (loop.index0 == 1 and 'warning' or 'secondary') }}">
                                        {{ score }}% match
                                    </span>
                                </div>
                                
                                <div class="row text-sm">
                                    <div class="col-6">
                                        <small class="text-muted">Email:</small><br>
                                        <small>{{ cliente.email }}</small>
                                    </div>
                                    <div class="col-6">
                                        <small class="text-muted">Telefone:</small><br>
                                        <small>{{ cliente.telefone or 'N/A' }}</small>
                                    </div>
                                </div>
                                
                                <div class="row mt-2 text-sm">
                                    <div class="col-6">
                                        <small class="text-muted">Gênero:</small><br>
                                        <small>{{ 'Masculino' if cliente.genero == 'M' else 'Feminino' }}</small>
                                    </div>
                                    <div class="col-6">
                                        <small class="text-muted">Idade:</small><br>
                                        <small>{{ cliente.idade }} anos</small>
                                    </div>
                                </div>
                                
                                <div class="row mt-2 text-sm">
                                    <div class="col-6">
                                        <small class="text-muted">Tamanho Pref.:</small><br>
                                        <small>{{ cliente.tamanho_preferido or 'N/A' }}</small>
                                    </div>
                                    <div class="col-6">
                                        <small class="text-muted">Total Compras:</small><br>
                                        <small>{{ cliente.vendas|length }}</small>
                                    </div>
                                </div>
                                
                                <div class="mt-3">
                                    {% if cliente.telefone %}
                                    <a href="https://wa.me/55{{ cliente.telefone.replace('(', '').replace(')', '').replace(' ', '').replace('-', '') }}?text=Olá {{ cliente.nome }}! A Shop Pra Mim tem um novo {{ produto.marca }} {{ produto.modelo }} {{ produto.cor }} tamanho {{ produto.tamanho }} que achamos que você vai gostar! Preço: R$ {{ '%.2f'|format(produto.preco) }}" 
                                       class="btn btn-success btn-sm w-100" target="_blank">
                                        <i class="fab fa-whatsapp me-2"></i>Enviar WhatsApp
                                    </a>
                                    {% else %}
                                    <button class="btn btn-outline-secondary btn-sm w-100" disabled>
                                        <i class="fas fa-phone-slash me-2"></i>Sem telefone
                                    </button>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                
                <div class="alert alert-info mt-3">
                    <i class="fas fa-lightbulb me-2"></i>
                    <strong>Como funciona o score:</strong> O sistema analisa histórico de compras (marca, cor, tamanho), 
                    faixa de preço preferida, frequência de compras e perfil do cliente para calcular a probabilidade de interesse.
                </div>
                
                {% else %}
                <div class="text-center py-4">
                    <i class="fas fa-search fa-2x text-muted mb-3"></i>
                    <h6 class="text-muted">Nenhuma recomendação encontrada</h6>
                    <p class="text-muted">Isso pode acontecer quando você ainda não tem clientes ou vendas suficientes para gerar recomendações precisas.</p>
                    <a href="{{ url_for('listar_clientes') }}" class="btn btn-primary">
                        <i class="fas fa-users me-2"></i>Cadastrar Clientes
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12 text-center">
        <a href="{{ url_for('cadastrar_produto') }}" class="btn btn-info me-2">
            <i class="fas fa-plus me-2"></i>Cadastrar Outro Produto
        </a>
        <a href="{{ url_for('index') }}" class="btn btn-secondary">
            <i class="fas fa-home me-2"></i>Voltar ao Dashboard
        </a>
    </div>
</div>
{% endblock %}

{% block scripts %}
<style>
.text-sm small {
    font-size: 0.85rem;
}
</style>
{% endblock %}